# 牌
## 牌の種類
- 牌は数牌と字牌からなる。
- 数牌は、色、数字、赤かどうかの属性を持つ。色は「萬、索、筒」のいずれか、数字は1から9である。
- 字牌は、字という属性をもち、それは「東、南、西、北、白、発、中」のいずれかの属性をもつ。

## 牌の枚数
- ゲームは、以下の136枚の牌を利用する。
    - 各色、5を除く数字に対し、赤でない4枚の牌 (合計 $3\times8\times4=96$ 枚)。
    - 各色に対し、数字が5である牌であって、赤であるもの1枚と、赤でないもの3枚 (合計 $3\times(1+3)=12$ 枚)。
    - 各字に対して4枚の牌 (合計 $7\times4=28$ 枚)。


# 試合の進行
## プレイヤー
- プレイヤー1から4までの4人が参加する。
- 次のプレイヤーとは、
    - プレイヤー1の次のプレイヤーはプレイヤー2である。
    - プレイヤー2の次のプレイヤーはプレイヤー3である。
    - プレイヤー3の次のプレイヤーはプレイヤー4である。
    - プレイヤー4の次のプレイヤーはプレイヤー1である。

## 試合の状態
- 試合は以下の状態を持つ。
    - 供託点数 (整数)。初期状態は 0。
    - 場風 (東あるいは南)。初期状態は東。
    - 親 (プレイヤー)。初期状態はプレイヤー1。
    - 本場 (非負整数)。初期状態は 0。
    - さらに、各プレイヤーは以下の状態を持つ。
        - 点数 (整数)。初期状態は 25000。
- 各局は以下の状態を持つ。初期状態は「局の開始」で定義される。
    - 牌山 (牌の列)。
    - 槓の回数 (0以上4以下の整数)。
    - 手番のプレイヤー (プレイヤー)。
    - さらに、各プレイヤーは以下の状態を持つ。
        - 手牌 (牌の集合)。
        - 副露牌 (牌の集合の集合)。
        - 暗槓牌（牌の集合の集合）。
        - 捨て牌 (牌の集合)。
        - リーチしているかどうか (真偽)。

## プレイヤーの知識
- 局の開始から終了までの間、プレイヤーは以下の情報を知らない。
    - 他人のプレイヤーの手牌。
    - 牌山のうち、以下の牌を除くもの。
        - 現在の槓の回数を $x$ としたとき、最後から $6-x, 6-x+2, \cdots, 6+2x$ 番目 (1-indexed) のもの。


# 局
## 局の開始
- 牌山を全ての牌からなり、順序が一様ランダムな列とする。
- 各プレイヤーが以下の操作を行う。
    - 牌山の先頭から $13$ 枚を引き、それを自分の手牌に加える。
- 状態を以下のように初期化する。
    - 槓の回数を 0 とする。
    - 手番のプレイヤーを親とする。
    - 各プレイヤーについて、手配、副露牌、捨て牌をから集合とし、リーチしているかどうかを偽とする。
- 「自摸操作」を開始する。

## 自摸操作
- 手番のプレイヤーが、牌山から $1$ 枚を引く。
- 「新たな牌」をこの引いた牌、「自摸である」を真として、「新たな牌を得たときの操作」を実施する。

## 新たな牌を得たときの操作
- この操作は以下の状態を受ける。
    - 新たな牌 (牌)。
    - 自摸であるかどうか (真偽)。
- 手番のプレイヤー(以下「自分」と呼ぶ)が、以下の操作を選ぶ。
    - カンを宣言する。
    - ツモを宣言する。
    - リーチを宣言する。
        - これは、以下の条件が満たされるときに実行可能である。
            - 牌山が $15$ 枚以上ある。
            - 副露牌が空集合である。
            - 自分の手牌、あるいは自摸牌の中に、以下の条件を満たすものが存在する。これを捨てる牌と呼ぶ。
                - 手配を、現在の手牌と自摸牌から除いたときに、自分が聴牌である。
        - このとき、以下の操作を実行する。
            - 自分が「リーチしようとしている」と宣言する。
            - 自分の手牌に自摸牌を加える。
            - 自分の手牌から捨てる牌を除き、自分の捨て牌に加える。
- 手番のプレイヤー以外の各プレイヤーが、以下の操作を選ぶ。
    - 何も宣言しない。
    - ロンを宣言する。
        - これは、以下の条件が満たされるときに実行可能である。
        - これが成立した場合、これを宣言したプレイヤーは以下の操作を行う。
    - ポンを宣言する。
        - これは、以下の条件が満たされるときに実行可能である。
        - これが成立した場合、これを宣言したプレイヤーは以下の操作を行う。
    - カンを宣言する。
        - これは、以下の条件が満たされるときに実行可能である。
        - これが成立した場合、これを宣言したプレイヤーは以下の操作を行う。
    - チーを宣言する。
        - これは、以下の条件が満たされるときに実行可能である。
        - これが成立した場合、これを宣言したプレイヤーは以下の操作を行う。
- 以下の処理を行う。
    - 手番のプレイヤーの次のプレイヤーがロンを宣言したなら、それを成立させる。
    - 手番のプレイヤーの次のプレイヤーの次のプレイヤーがロンを宣言したなら、それを成立させる。
    - 手番のプレイヤーの次のプレイヤーの次のプレイヤーの次のプレイヤーがロンを宣言したなら、それを成立させる。
    - 1人以上がポンあるいはカンを宣言したなら、それを成立させる。
    - 次のプレイヤーがチーを宣言したなら、それを成立させる。
    - それ以外の場合、以下の処理を行う。
        - 手番のプレイヤーを現在の手番のプレイヤーの次のプレイヤーとし、「自摸操作」を行う。

## 和了ったときの操作
